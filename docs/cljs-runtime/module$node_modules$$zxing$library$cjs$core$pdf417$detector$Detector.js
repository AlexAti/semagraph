shadow$provide.module$node_modules$$zxing$library$cjs$core$pdf417$detector$Detector=function(global,require,module,exports){var __values=this&&this.__values||function(o){var s="function"===typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"===typeof o.length)return{next:function(){o&&i>=o.length&&(o=void 0);return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.");};Object.defineProperty(exports,"__esModule",
{value:!0});var ResultPoint_1=require("module$node_modules$$zxing$library$cjs$core$ResultPoint"),System_1=require("module$node_modules$$zxing$library$cjs$core$util$System"),Arrays_1=require("module$node_modules$$zxing$library$cjs$core$util$Arrays"),PDF417DetectorResult_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$detector$PDF417DetectorResult");global=function(){function Detector(){}Detector.detectMultiple=function(image,hints,multiple){image=image.getBlackMatrix();hints=Detector.detect(multiple,
image);hints.length||(image=image.clone(),image.rotate180(),hints=Detector.detect(multiple,image));return new PDF417DetectorResult_1.default(image,hints)};Detector.detect=function(multiple,bitMatrix){for(var e_1,_a,barcodeCoordinates=[],row=0,column=0,foundBarcodeInRow=!1;row<bitMatrix.getHeight();){var vertices=Detector.findVertices(bitMatrix,row,column);if(null==vertices[0]&&null==vertices[3]){if(!foundBarcodeInRow)break;foundBarcodeInRow=!1;column=0;try{for(var barcodeCoordinates_1=(e_1=void 0,
__values(barcodeCoordinates)),barcodeCoordinates_1_1=barcodeCoordinates_1.next();!barcodeCoordinates_1_1.done;barcodeCoordinates_1_1=barcodeCoordinates_1.next()){var barcodeCoordinate=barcodeCoordinates_1_1.value;null!=barcodeCoordinate[1]&&(row=Math.trunc(Math.max(row,barcodeCoordinate[1].getY())));null!=barcodeCoordinate[3]&&(row=Math.max(row,Math.trunc(barcodeCoordinate[3].getY())))}}catch(e_1_1){e_1={error:e_1_1}}finally{try{barcodeCoordinates_1_1&&!barcodeCoordinates_1_1.done&&(_a=barcodeCoordinates_1.return)&&
_a.call(barcodeCoordinates_1)}finally{if(e_1)throw e_1.error;}}row+=Detector.ROW_STEP}else{foundBarcodeInRow=!0;barcodeCoordinates.push(vertices);if(!multiple)break;null!=vertices[2]?(column=Math.trunc(vertices[2].getX()),row=Math.trunc(vertices[2].getY())):(column=Math.trunc(vertices[4].getX()),row=Math.trunc(vertices[4].getY()))}}return barcodeCoordinates};Detector.findVertices=function(matrix,startRow,startColumn){var height=matrix.getHeight(),width=matrix.getWidth(),result=Array(8);Detector.copyToResult(result,
Detector.findRowsWithPattern(matrix,height,width,startRow,startColumn,Detector.START_PATTERN),Detector.INDEXES_START_PATTERN);null!=result[4]&&(startColumn=Math.trunc(result[4].getX()),startRow=Math.trunc(result[4].getY()));Detector.copyToResult(result,Detector.findRowsWithPattern(matrix,height,width,startRow,startColumn,Detector.STOP_PATTERN),Detector.INDEXES_STOP_PATTERN);return result};Detector.copyToResult=function(result,tmpResult,destinationIndexes){for(var i=0;i<destinationIndexes.length;i++)result[destinationIndexes[i]]=
tmpResult[i]};Detector.findRowsWithPattern=function(matrix,height,width,startRow,startColumn,pattern){for(var result=Array(4),found=!1,counters=new Int32Array(pattern.length);startRow<height;startRow+=Detector.ROW_STEP){var loc=Detector.findGuardPattern(matrix,startColumn,startRow,width,!1,pattern,counters);if(null!=loc){for(;0<startRow;)if(found=Detector.findGuardPattern(matrix,startColumn,--startRow,width,!1,pattern,counters),null!=found)loc=found;else{startRow++;break}result[0]=new ResultPoint_1.default(loc[0],
startRow);result[1]=new ResultPoint_1.default(loc[1],startRow);found=!0;break}}startColumn=startRow+1;if(found){var skippedRowCount=0;for(found=Int32Array.from([Math.trunc(result[0].getX()),Math.trunc(result[1].getX())]);startColumn<height;startColumn++)if(loc=Detector.findGuardPattern(matrix,found[0],startColumn,width,!1,pattern,counters),null!=loc&&Math.abs(found[0]-loc[0])<Detector.MAX_PATTERN_DRIFT&&Math.abs(found[1]-loc[1])<Detector.MAX_PATTERN_DRIFT)found=loc,skippedRowCount=0;else if(skippedRowCount>
Detector.SKIPPED_ROW_COUNT_MAX)break;else skippedRowCount++;startColumn-=skippedRowCount+1;result[2]=new ResultPoint_1.default(found[0],startColumn);result[3]=new ResultPoint_1.default(found[1],startColumn)}startColumn-startRow<Detector.BARCODE_MIN_HEIGHT&&Arrays_1.default.fill(result,null);return result};Detector.findGuardPattern=function(matrix,column,row,width,whiteFirst,pattern,counters){Arrays_1.default.fillWithin(counters,0,counters.length,0);for(var pixelDrift=0;matrix.get(column,row)&&0<column&&
pixelDrift++<Detector.MAX_PIXEL_DRIFT;)column--;pixelDrift=column;for(var counterPosition=0,patternLength=pattern.length;pixelDrift<width;pixelDrift++)if(matrix.get(pixelDrift,row)!==whiteFirst)counters[counterPosition]++;else{if(counterPosition===patternLength-1){if(Detector.patternMatchVariance(counters,pattern,Detector.MAX_INDIVIDUAL_VARIANCE)<Detector.MAX_AVG_VARIANCE)return new Int32Array([column,pixelDrift]);column+=counters[0]+counters[1];System_1.default.arraycopy(counters,2,counters,0,counterPosition-
1);counters[counterPosition-1]=0;counters[counterPosition]=0;counterPosition--}else counterPosition++;counters[counterPosition]=1;whiteFirst=!whiteFirst}return counterPosition===patternLength-1&&Detector.patternMatchVariance(counters,pattern,Detector.MAX_INDIVIDUAL_VARIANCE)<Detector.MAX_AVG_VARIANCE?new Int32Array([column,pixelDrift-1]):null};Detector.patternMatchVariance=function(counters,pattern,maxIndividualVariance){for(var numCounters=counters.length,total=0,patternLength=0,i=0;i<numCounters;i++)total+=
counters[i],patternLength+=pattern[i];if(total<patternLength)return Infinity;patternLength=total/patternLength;maxIndividualVariance*=patternLength;for(var x=i=0;x<numCounters;x++){var counter=counters[x],scaledPattern=pattern[x]*patternLength;counter=counter>scaledPattern?counter-scaledPattern:scaledPattern-counter;if(counter>maxIndividualVariance)return Infinity;i+=counter}return i/total};Detector.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]);Detector.INDEXES_STOP_PATTERN=Int32Array.from([6,
2,7,3]);Detector.MAX_AVG_VARIANCE=.42;Detector.MAX_INDIVIDUAL_VARIANCE=.8;Detector.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]);Detector.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]);Detector.MAX_PIXEL_DRIFT=3;Detector.MAX_PATTERN_DRIFT=5;Detector.SKIPPED_ROW_COUNT_MAX=25;Detector.ROW_STEP=5;Detector.BARCODE_MIN_HEIGHT=10;return Detector}();exports.default=global}
//# sourceMappingURL=module$node_modules$$zxing$library$cjs$core$pdf417$detector$Detector.js.map
