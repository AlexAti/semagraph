shadow$provide.module$node_modules$$zxing$library$cjs$browser$BrowserCodeReader=function(global,require,module,exports){var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new (P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=
0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=0<t.length&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3]))_.label=op[1];else if(6===op[0]&&_.label<t[1])_.label=t[1],t=op;else if(t&&_.label<t[2])_.label=t[2],_.ops.push(op);else{t[2]&&_.ops.pop();_.trys.pop();continue}}op=body.call(thisArg,
_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),"throw":verb(1),"return":verb(2)},"function"===typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g},__values=this&&this.__values||function(o){var s="function"===typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"===typeof o.length)return{next:function(){o&&
i>=o.length&&(o=void 0);return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.");};Object.defineProperty(exports,"__esModule",{value:!0});exports.BrowserCodeReader=void 0;var ArgumentException_1=require("module$node_modules$$zxing$library$cjs$core$ArgumentException"),BinaryBitmap_1=require("module$node_modules$$zxing$library$cjs$core$BinaryBitmap"),ChecksumException_1=require("module$node_modules$$zxing$library$cjs$core$ChecksumException"),
HybridBinarizer_1=require("module$node_modules$$zxing$library$cjs$core$common$HybridBinarizer"),FormatException_1=require("module$node_modules$$zxing$library$cjs$core$FormatException"),NotFoundException_1=require("module$node_modules$$zxing$library$cjs$core$NotFoundException"),HTMLCanvasElementLuminanceSource_1=require("module$node_modules$$zxing$library$cjs$browser$HTMLCanvasElementLuminanceSource"),VideoInputDevice_1=require("module$node_modules$$zxing$library$cjs$browser$VideoInputDevice");global=
function(){function BrowserCodeReader(reader,timeBetweenScansMillis,_hints){void 0===timeBetweenScansMillis&&(timeBetweenScansMillis=500);this.reader=reader;this.timeBetweenScansMillis=timeBetweenScansMillis;this._hints=_hints;this._stopAsyncDecode=this._stopContinuousDecode=!1;this._timeBetweenDecodingAttempts=0}Object.defineProperty(BrowserCodeReader.prototype,"hasNavigator",{get:function(){return"undefined"!==typeof navigator},enumerable:!1,configurable:!0});Object.defineProperty(BrowserCodeReader.prototype,
"isMediaDevicesSuported",{get:function(){return this.hasNavigator&&!!navigator.mediaDevices},enumerable:!1,configurable:!0});Object.defineProperty(BrowserCodeReader.prototype,"canEnumerateDevices",{get:function(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)},enumerable:!1,configurable:!0});Object.defineProperty(BrowserCodeReader.prototype,"timeBetweenDecodingAttempts",{get:function(){return this._timeBetweenDecodingAttempts},set:function(millis){this._timeBetweenDecodingAttempts=
0>millis?0:millis},enumerable:!1,configurable:!0});Object.defineProperty(BrowserCodeReader.prototype,"hints",{get:function(){return this._hints},set:function(hints){this._hints=hints||null},enumerable:!1,configurable:!0});BrowserCodeReader.prototype.listVideoInputDevices=function(){return __awaiter(this,void 0,void 0,function(){var devices,videoDevices,devices_1,devices_1_1,device,kind,deviceId,label,groupId,videoDevice,e_1,_a;return __generator(this,function(_b){switch(_b.label){case 0:if(!this.hasNavigator)throw Error("Can't enumerate devices, navigator is not present.");
if(!this.canEnumerateDevices)throw Error("Can't enumerate devices, method not supported.");return[4,navigator.mediaDevices.enumerateDevices()];case 1:devices=_b.sent();videoDevices=[];try{for(devices_1=__values(devices),devices_1_1=devices_1.next();!devices_1_1.done;devices_1_1=devices_1.next())device=devices_1_1.value,kind="video"===device.kind?"videoinput":device.kind,"videoinput"===kind&&(deviceId=device.deviceId||device.id,label=device.label||"Video device "+(videoDevices.length+1),groupId=device.groupId,
videoDevice={deviceId,label,kind,groupId},videoDevices.push(videoDevice))}catch(e_1_1){e_1={error:e_1_1}}finally{try{devices_1_1&&!devices_1_1.done&&(_a=devices_1.return)&&_a.call(devices_1)}finally{if(e_1)throw e_1.error;}}return[2,videoDevices]}})})};BrowserCodeReader.prototype.getVideoInputDevices=function(){return __awaiter(this,void 0,void 0,function(){var devices;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.listVideoInputDevices()];case 1:return devices=_a.sent(),
[2,devices.map(function(d){return new VideoInputDevice_1.VideoInputDevice(d.deviceId,d.label)})]}})})};BrowserCodeReader.prototype.findDeviceById=function(deviceId){return __awaiter(this,void 0,void 0,function(){var devices;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.listVideoInputDevices()];case 1:return(devices=_a.sent())?[2,devices.find(function(x){return x.deviceId===deviceId})]:[2,null]}})})};BrowserCodeReader.prototype.decodeFromInputVideoDevice=function(deviceId,
videoSource){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.decodeOnceFromVideoDevice(deviceId,videoSource)];case 1:return[2,_a.sent()]}})})};BrowserCodeReader.prototype.decodeOnceFromVideoDevice=function(deviceId,videoSource){return __awaiter(this,void 0,void 0,function(){var videoConstraints,constraints;return __generator(this,function(_a){switch(_a.label){case 0:return this.reset(),videoConstraints=deviceId?{deviceId:{exact:deviceId}}:
{facingMode:"environment"},constraints={video:videoConstraints},[4,this.decodeOnceFromConstraints(constraints,videoSource)];case 1:return[2,_a.sent()]}})})};BrowserCodeReader.prototype.decodeOnceFromConstraints=function(constraints,videoSource){return __awaiter(this,void 0,void 0,function(){var stream;return __generator(this,function(_a){switch(_a.label){case 0:return[4,navigator.mediaDevices.getUserMedia(constraints)];case 1:return stream=_a.sent(),[4,this.decodeOnceFromStream(stream,videoSource)];
case 2:return[2,_a.sent()]}})})};BrowserCodeReader.prototype.decodeOnceFromStream=function(stream,videoSource){return __awaiter(this,void 0,void 0,function(){var video,result;return __generator(this,function(_a){switch(_a.label){case 0:return this.reset(),[4,this.attachStreamToVideo(stream,videoSource)];case 1:return video=_a.sent(),[4,this.decodeOnce(video)];case 2:return result=_a.sent(),[2,result]}})})};BrowserCodeReader.prototype.decodeFromInputVideoDeviceContinuously=function(deviceId,videoSource,
callbackFn){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.decodeFromVideoDevice(deviceId,videoSource,callbackFn)];case 1:return[2,_a.sent()]}})})};BrowserCodeReader.prototype.decodeFromVideoDevice=function(deviceId,videoSource,callbackFn){return __awaiter(this,void 0,void 0,function(){var videoConstraints,constraints;return __generator(this,function(_a){switch(_a.label){case 0:return videoConstraints=deviceId?{deviceId:{exact:deviceId}}:
{facingMode:"environment"},constraints={video:videoConstraints},[4,this.decodeFromConstraints(constraints,videoSource,callbackFn)];case 1:return[2,_a.sent()]}})})};BrowserCodeReader.prototype.decodeFromConstraints=function(constraints,videoSource,callbackFn){return __awaiter(this,void 0,void 0,function(){var stream;return __generator(this,function(_a){switch(_a.label){case 0:return[4,navigator.mediaDevices.getUserMedia(constraints)];case 1:return stream=_a.sent(),[4,this.decodeFromStream(stream,videoSource,
callbackFn)];case 2:return[2,_a.sent()]}})})};BrowserCodeReader.prototype.decodeFromStream=function(stream,videoSource,callbackFn){return __awaiter(this,void 0,void 0,function(){var video;return __generator(this,function(_a){switch(_a.label){case 0:return this.reset(),[4,this.attachStreamToVideo(stream,videoSource)];case 1:return video=_a.sent(),[4,this.decodeContinuously(video,callbackFn)];case 2:return[2,_a.sent()]}})})};BrowserCodeReader.prototype.stopAsyncDecode=function(){this._stopAsyncDecode=
!0};BrowserCodeReader.prototype.stopContinuousDecode=function(){this._stopContinuousDecode=!0};BrowserCodeReader.prototype.attachStreamToVideo=function(stream,videoSource){return __awaiter(this,void 0,void 0,function(){var videoElement;return __generator(this,function(_a){switch(_a.label){case 0:return videoElement=this.prepareVideoElement(videoSource),this.addVideoSource(videoElement,stream),this.videoElement=videoElement,this.stream=stream,[4,this.playVideoOnLoadAsync(videoElement)];case 1:return _a.sent(),
[2,videoElement]}})})};BrowserCodeReader.prototype.playVideoOnLoadAsync=function(videoElement){var _this=this;return new Promise(function(resolve,reject){return _this.playVideoOnLoad(videoElement,function(){return resolve()})})};BrowserCodeReader.prototype.playVideoOnLoad=function(element,callbackFn){var _this=this;this.videoEndedListener=function(){return _this.stopStreams()};this.videoCanPlayListener=function(){return _this.tryPlayVideo(element)};element.addEventListener("ended",this.videoEndedListener);
element.addEventListener("canplay",this.videoCanPlayListener);element.addEventListener("playing",callbackFn);this.tryPlayVideo(element)};BrowserCodeReader.prototype.isVideoPlaying=function(video){return 0<video.currentTime&&!video.paused&&!video.ended&&2<video.readyState};BrowserCodeReader.prototype.tryPlayVideo=function(videoElement){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_b){switch(_b.label){case 0:if(this.isVideoPlaying(videoElement))return console.warn("Trying to play video that is already playing."),
[2];_b.label=1;case 1:return _b.trys.push([1,3,,4]),[4,videoElement.play()];case 2:return _b.sent(),[3,4];case 3:return _b.sent(),console.warn("It was not possible to play the video."),[3,4];case 4:return[2]}})})};BrowserCodeReader.prototype.getMediaElement=function(mediaElementId,type){var mediaElement=document.getElementById(mediaElementId);if(!mediaElement)throw new ArgumentException_1.default("element with id '"+mediaElementId+"' not found");if(mediaElement.nodeName.toLowerCase()!==type.toLowerCase())throw new ArgumentException_1.default("element with id '"+
mediaElementId+"' must be an "+type+" element");return mediaElement};BrowserCodeReader.prototype.decodeFromImage=function(source,url){if(!source&&!url)throw new ArgumentException_1.default("either imageElement with a src set or an url must be provided");return url&&!source?this.decodeFromImageUrl(url):this.decodeFromImageElement(source)};BrowserCodeReader.prototype.decodeFromVideo=function(source,url){if(!source&&!url)throw new ArgumentException_1.default("Either an element with a src set or an URL must be provided");
return url&&!source?this.decodeFromVideoUrl(url):this.decodeFromVideoElement(source)};BrowserCodeReader.prototype.decodeFromVideoContinuously=function(source,url,callbackFn){if(void 0===source&&void 0===url)throw new ArgumentException_1.default("Either an element with a src set or an URL must be provided");return url&&!source?this.decodeFromVideoUrlContinuously(url,callbackFn):this.decodeFromVideoElementContinuously(source,callbackFn)};BrowserCodeReader.prototype.decodeFromImageElement=function(source){if(!source)throw new ArgumentException_1.default("An image element must be provided.");
this.reset();this.imageElement=source=this.prepareImageElement(source);return this.isImageLoaded(source)?this.decodeOnce(source,!1,!0):this._decodeOnLoadImage(source)};BrowserCodeReader.prototype.decodeFromVideoElement=function(source){source=this._decodeFromVideoElementSetup(source);return this._decodeOnLoadVideo(source)};BrowserCodeReader.prototype.decodeFromVideoElementContinuously=function(source,callbackFn){source=this._decodeFromVideoElementSetup(source);return this._decodeOnLoadVideoContinuously(source,
callbackFn)};BrowserCodeReader.prototype._decodeFromVideoElementSetup=function(source){if(!source)throw new ArgumentException_1.default("A video element must be provided.");this.reset();return this.videoElement=source=this.prepareVideoElement(source)};BrowserCodeReader.prototype.decodeFromImageUrl=function(url){if(!url)throw new ArgumentException_1.default("An URL must be provided.");this.reset();var element=this.prepareImageElement();this.imageElement=element;var decodeTask=this._decodeOnLoadImage(element);
element.src=url;return decodeTask};BrowserCodeReader.prototype.decodeFromVideoUrl=function(url){if(!url)throw new ArgumentException_1.default("An URL must be provided.");this.reset();var element=this.prepareVideoElement(),decodeTask=this.decodeFromVideoElement(element);element.src=url;return decodeTask};BrowserCodeReader.prototype.decodeFromVideoUrlContinuously=function(url,callbackFn){if(!url)throw new ArgumentException_1.default("An URL must be provided.");this.reset();var element=this.prepareVideoElement();
callbackFn=this.decodeFromVideoElementContinuously(element,callbackFn);element.src=url;return callbackFn};BrowserCodeReader.prototype._decodeOnLoadImage=function(element){var _this=this;return new Promise(function(resolve,reject){_this.imageLoadedListener=function(){return _this.decodeOnce(element,!1,!0).then(resolve,reject)};element.addEventListener("load",_this.imageLoadedListener)})};BrowserCodeReader.prototype._decodeOnLoadVideo=function(videoElement){return __awaiter(this,void 0,void 0,function(){return __generator(this,
function(_a){switch(_a.label){case 0:return[4,this.playVideoOnLoadAsync(videoElement)];case 1:return _a.sent(),[4,this.decodeOnce(videoElement)];case 2:return[2,_a.sent()]}})})};BrowserCodeReader.prototype._decodeOnLoadVideoContinuously=function(videoElement,callbackFn){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.playVideoOnLoadAsync(videoElement)];case 1:return _a.sent(),this.decodeContinuously(videoElement,callbackFn),
[2]}})})};BrowserCodeReader.prototype.isImageLoaded=function(img){return img.complete&&0!==img.naturalWidth?!0:!1};BrowserCodeReader.prototype.prepareImageElement=function(imageSource){if("undefined"===typeof imageSource){var imageElement=document.createElement("img");imageElement.width=200;imageElement.height=200}"string"===typeof imageSource&&(imageElement=this.getMediaElement(imageSource,"img"));imageSource instanceof HTMLImageElement&&(imageElement=imageSource);return imageElement};BrowserCodeReader.prototype.prepareVideoElement=
function(videoSource){if(!videoSource&&"undefined"!==typeof document){var videoElement=document.createElement("video");videoElement.width=200;videoElement.height=200}"string"===typeof videoSource&&(videoElement=this.getMediaElement(videoSource,"video"));videoSource instanceof HTMLVideoElement&&(videoElement=videoSource);videoElement.setAttribute("autoplay","true");videoElement.setAttribute("muted","true");videoElement.setAttribute("playsinline","true");return videoElement};BrowserCodeReader.prototype.decodeOnce=
function(element,retryIfNotFound,retryIfChecksumOrFormatError){var _this=this;void 0===retryIfNotFound&&(retryIfNotFound=!0);void 0===retryIfChecksumOrFormatError&&(retryIfChecksumOrFormatError=!0);this._stopAsyncDecode=!1;var loop=function(resolve,reject){if(_this._stopAsyncDecode)reject(new NotFoundException_1.default("Video stream has ended before any code could be detected.")),_this._stopAsyncDecode=void 0;else try{var result=_this.decode(element);resolve(result)}catch(e){result=(e instanceof
ChecksumException_1.default||e instanceof FormatException_1.default)&&retryIfChecksumOrFormatError;if(retryIfNotFound&&e instanceof NotFoundException_1.default||result)return setTimeout(loop,_this._timeBetweenDecodingAttempts,resolve,reject);reject(e)}};return new Promise(function(resolve,reject){return loop(resolve,reject)})};BrowserCodeReader.prototype.decodeContinuously=function(element,callbackFn){var _this=this;this._stopContinuousDecode=!1;var loop=function(){if(_this._stopContinuousDecode)_this._stopContinuousDecode=
void 0;else try{var result=_this.decode(element);callbackFn(result,null);setTimeout(loop,_this.timeBetweenScansMillis)}catch(e){callbackFn(null,e),result=e instanceof NotFoundException_1.default,(e instanceof ChecksumException_1.default||e instanceof FormatException_1.default||result)&&setTimeout(loop,_this._timeBetweenDecodingAttempts)}};loop()};BrowserCodeReader.prototype.decode=function(element){element=this.createBinaryBitmap(element);return this.decodeBitmap(element)};BrowserCodeReader.prototype._isHTMLVideoElement=
function(mediaElement){return 0!==mediaElement.videoWidth};BrowserCodeReader.prototype.createBinaryBitmap=function(mediaElement){this.getCaptureCanvasContext(mediaElement);this._isHTMLVideoElement(mediaElement)?this.drawFrameOnCanvas(mediaElement):this.drawImageOnCanvas(mediaElement);mediaElement=this.getCaptureCanvas(mediaElement);mediaElement=new HTMLCanvasElementLuminanceSource_1.HTMLCanvasElementLuminanceSource(mediaElement);mediaElement=new HybridBinarizer_1.default(mediaElement);return new BinaryBitmap_1.default(mediaElement)};
BrowserCodeReader.prototype.getCaptureCanvasContext=function(mediaElement){this.captureCanvasContext||(this.captureCanvasContext=this.getCaptureCanvas(mediaElement).getContext("2d"));return this.captureCanvasContext};BrowserCodeReader.prototype.getCaptureCanvas=function(mediaElement){this.captureCanvas||(this.captureCanvas=this.createCaptureCanvas(mediaElement));return this.captureCanvas};BrowserCodeReader.prototype.drawFrameOnCanvas=function(srcElement,dimensions,canvasElementContext){void 0===dimensions&&
(dimensions={sx:0,sy:0,sWidth:srcElement.videoWidth,sHeight:srcElement.videoHeight,dx:0,dy:0,dWidth:srcElement.videoWidth,dHeight:srcElement.videoHeight});void 0===canvasElementContext&&(canvasElementContext=this.captureCanvasContext);canvasElementContext.drawImage(srcElement,dimensions.sx,dimensions.sy,dimensions.sWidth,dimensions.sHeight,dimensions.dx,dimensions.dy,dimensions.dWidth,dimensions.dHeight)};BrowserCodeReader.prototype.drawImageOnCanvas=function(srcElement,dimensions,canvasElementContext){void 0===
dimensions&&(dimensions={sx:0,sy:0,sWidth:srcElement.naturalWidth,sHeight:srcElement.naturalHeight,dx:0,dy:0,dWidth:srcElement.naturalWidth,dHeight:srcElement.naturalHeight});void 0===canvasElementContext&&(canvasElementContext=this.captureCanvasContext);canvasElementContext.drawImage(srcElement,dimensions.sx,dimensions.sy,dimensions.sWidth,dimensions.sHeight,dimensions.dx,dimensions.dy,dimensions.dWidth,dimensions.dHeight)};BrowserCodeReader.prototype.decodeBitmap=function(binaryBitmap){return this.reader.decode(binaryBitmap,
this._hints)};BrowserCodeReader.prototype.createCaptureCanvas=function(mediaElement){if("undefined"===typeof document)return this._destroyCaptureCanvas(),null;var canvasElement=document.createElement("canvas");if("undefined"!==typeof mediaElement)if(mediaElement instanceof HTMLVideoElement){var width=mediaElement.videoWidth;var height=mediaElement.videoHeight}else mediaElement instanceof HTMLImageElement&&(width=mediaElement.naturalWidth||mediaElement.width,height=mediaElement.naturalHeight||mediaElement.height);
canvasElement.style.width=width+"px";canvasElement.style.height=height+"px";canvasElement.width=width;canvasElement.height=height;return canvasElement};BrowserCodeReader.prototype.stopStreams=function(){this.stream&&(this.stream.getVideoTracks().forEach(function(t){return t.stop()}),this.stream=void 0);!1===this._stopAsyncDecode&&this.stopAsyncDecode();!1===this._stopContinuousDecode&&this.stopContinuousDecode()};BrowserCodeReader.prototype.reset=function(){this.stopStreams();this._destroyVideoElement();
this._destroyImageElement();this._destroyCaptureCanvas()};BrowserCodeReader.prototype._destroyVideoElement=function(){this.videoElement&&("undefined"!==typeof this.videoEndedListener&&this.videoElement.removeEventListener("ended",this.videoEndedListener),"undefined"!==typeof this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),"undefined"!==typeof this.videoCanPlayListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),
this.cleanVideoSource(this.videoElement),this.videoElement=void 0)};BrowserCodeReader.prototype._destroyImageElement=function(){this.imageElement&&(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)};BrowserCodeReader.prototype._destroyCaptureCanvas=function(){this.captureCanvas=this.captureCanvasContext=void 0};BrowserCodeReader.prototype.addVideoSource=
function(videoElement,stream){try{videoElement.srcObject=stream}catch(err){videoElement.src=URL.createObjectURL(stream)}};BrowserCodeReader.prototype.cleanVideoSource=function(videoElement){try{videoElement.srcObject=null}catch(err){videoElement.src=""}this.videoElement.removeAttribute("src")};return BrowserCodeReader}();exports.BrowserCodeReader=global}
//# sourceMappingURL=module$node_modules$$zxing$library$cjs$browser$BrowserCodeReader.js.map
