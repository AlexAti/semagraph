shadow$provide.module$node_modules$$zxing$library$cjs$core$aztec$decoder$Decoder=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var DecoderResult_1=require("module$node_modules$$zxing$library$cjs$core$common$DecoderResult"),GenericGF_1=require("module$node_modules$$zxing$library$cjs$core$common$reedsolomon$GenericGF"),ReedSolomonDecoder_1=require("module$node_modules$$zxing$library$cjs$core$common$reedsolomon$ReedSolomonDecoder"),IllegalStateException_1=
require("module$node_modules$$zxing$library$cjs$core$IllegalStateException"),FormatException_1=require("module$node_modules$$zxing$library$cjs$core$FormatException"),StringUtils_1=require("module$node_modules$$zxing$library$cjs$core$common$StringUtils"),Integer_1=require("module$node_modules$$zxing$library$cjs$core$util$Integer"),Table;(function(Table){Table[Table.UPPER=0]="UPPER";Table[Table.LOWER=1]="LOWER";Table[Table.MIXED=2]="MIXED";Table[Table.DIGIT=3]="DIGIT";Table[Table.PUNCT=4]="PUNCT";Table[Table.BINARY=
5]="BINARY"})(Table||(Table={}));global=function(){function Decoder(){}Decoder.prototype.decode=function(detectorResult){this.ddata=detectorResult;detectorResult=detectorResult.getBits();detectorResult=this.extractBits(detectorResult);detectorResult=this.correctBits(detectorResult);var rawBytes=Decoder.convertBoolArrayToByteArray(detectorResult),result=Decoder.getEncodedData(detectorResult);rawBytes=new DecoderResult_1.default(rawBytes,result,null,null);rawBytes.setNumBits(detectorResult.length);
return rawBytes};Decoder.highLevelDecode=function(correctedBits){return this.getEncodedData(correctedBits)};Decoder.getEncodedData=function(correctedBits){for(var endIndex=correctedBits.length,latchTable=Table.UPPER,shiftTable=Table.UPPER,result="",index=0;index<endIndex;)if(shiftTable===Table.BINARY){if(5>endIndex-index)break;shiftTable=Decoder.readCode(correctedBits,index,5);index+=5;if(0===shiftTable){if(11>endIndex-index)break;shiftTable=Decoder.readCode(correctedBits,index,11)+31;index+=11}for(var charCount=
0;charCount<shiftTable;charCount++){if(8>endIndex-index){index=endIndex;break}var code=Decoder.readCode(correctedBits,index,8);result+=StringUtils_1.default.castAsNonUtf8Char(code);index+=8}shiftTable=latchTable}else{charCount=shiftTable===Table.DIGIT?4:5;if(endIndex-index<charCount)break;code=Decoder.readCode(correctedBits,index,charCount);index+=charCount;code=Decoder.getCharacter(shiftTable,code);code.startsWith("CTRL_")?(latchTable=shiftTable,shiftTable=Decoder.getTable(code.charAt(5)),"L"===
code.charAt(6)&&(latchTable=shiftTable)):(result+=code,shiftTable=latchTable)}return result};Decoder.getTable=function(t){switch(t){case "L":return Table.LOWER;case "P":return Table.PUNCT;case "M":return Table.MIXED;case "D":return Table.DIGIT;case "B":return Table.BINARY;default:return Table.UPPER}};Decoder.getCharacter=function(table,code){switch(table){case Table.UPPER:return Decoder.UPPER_TABLE[code];case Table.LOWER:return Decoder.LOWER_TABLE[code];case Table.MIXED:return Decoder.MIXED_TABLE[code];
case Table.PUNCT:return Decoder.PUNCT_TABLE[code];case Table.DIGIT:return Decoder.DIGIT_TABLE[code];default:throw new IllegalStateException_1.default("Bad table");}};Decoder.prototype.correctBits=function(rawbits){if(2>=this.ddata.getNbLayers()){var codewordSize=6;var gf=GenericGF_1.default.AZTEC_DATA_6}else 8>=this.ddata.getNbLayers()?(codewordSize=8,gf=GenericGF_1.default.AZTEC_DATA_8):22>=this.ddata.getNbLayers()?(codewordSize=10,gf=GenericGF_1.default.AZTEC_DATA_10):(codewordSize=12,gf=GenericGF_1.default.AZTEC_DATA_12);
var numDataCodewords=this.ddata.getNbDatablocks(),numCodewords=rawbits.length/codewordSize;if(numCodewords<numDataCodewords)throw new FormatException_1.default;for(var offset=rawbits.length%codewordSize,dataWords=new Int32Array(numCodewords),i=0;i<numCodewords;i++,offset+=codewordSize)dataWords[i]=Decoder.readCode(rawbits,offset,codewordSize);try{(new ReedSolomonDecoder_1.default(gf)).decode(dataWords,numCodewords-numDataCodewords)}catch(ex){throw new FormatException_1.default(ex);}rawbits=(1<<codewordSize)-
1;for(i=numCodewords=0;i<numDataCodewords;i++){gf=dataWords[i];if(0===gf||gf===rawbits)throw new FormatException_1.default;1!==gf&&gf!==rawbits-1||numCodewords++}numCodewords=Array(numDataCodewords*codewordSize-numCodewords);for(i=offset=0;i<numDataCodewords;i++)if(gf=dataWords[i],1===gf||gf===rawbits-1)numCodewords.fill(1<gf,offset,offset+codewordSize-1),offset+=codewordSize-1;else for(var bit=codewordSize-1;0<=bit;--bit)numCodewords[offset++]=0!==(gf&1<<bit);return numCodewords};Decoder.prototype.extractBits=
function(matrix){var compact=this.ddata.isCompact(),layers=this.ddata.getNbLayers(),baseMatrixSize=(compact?11:14)+4*layers,alignmentMap=new Int32Array(baseMatrixSize),rawbits=Array(this.totalBitsInLayer(layers,compact));if(compact)for(var i=0;i<alignmentMap.length;i++)alignmentMap[i]=i;else{i=baseMatrixSize+1+2*Integer_1.default.truncDivision(Integer_1.default.truncDivision(baseMatrixSize,2)-1,15);var origCenter=baseMatrixSize/2,center=Integer_1.default.truncDivision(i,2);for(i=0;i<origCenter;i++){var newOffset=
i+Integer_1.default.truncDivision(i,15);alignmentMap[origCenter-i-1]=center-newOffset-1;alignmentMap[origCenter+i]=center+newOffset+1}}for(origCenter=i=0;i<layers;i++){center=4*(layers-i)+(compact?9:12);newOffset=2*i;for(var high=baseMatrixSize-1-newOffset,j=0;j<center;j++)for(var columnOffset=2*j,k=0;2>k;k++)rawbits[origCenter+columnOffset+k]=matrix.get(alignmentMap[newOffset+k],alignmentMap[newOffset+j]),rawbits[origCenter+2*center+columnOffset+k]=matrix.get(alignmentMap[newOffset+j],alignmentMap[high-
k]),rawbits[origCenter+4*center+columnOffset+k]=matrix.get(alignmentMap[high-k],alignmentMap[high-j]),rawbits[origCenter+6*center+columnOffset+k]=matrix.get(alignmentMap[high-j],alignmentMap[newOffset+k]);origCenter+=8*center}return rawbits};Decoder.readCode=function(rawbits,startIndex,length){for(var res=0,i=startIndex;i<startIndex+length;i++)res<<=1,rawbits[i]&&(res|=1);return res};Decoder.readByte=function(rawbits,startIndex){var n=rawbits.length-startIndex;return 8<=n?Decoder.readCode(rawbits,
startIndex,8):Decoder.readCode(rawbits,startIndex,n)<<8-n};Decoder.convertBoolArrayToByteArray=function(boolArr){for(var byteArr=new Uint8Array((boolArr.length+7)/8),i=0;i<byteArr.length;i++)byteArr[i]=Decoder.readByte(boolArr,8*i);return byteArr};Decoder.prototype.totalBitsInLayer=function(layers,compact){return((compact?88:112)+16*layers)*layers};Decoder.UPPER_TABLE="CTRL_PS; ;A;B;C;D;E;F;G;H;I;J;K;L;M;N;O;P;Q;R;S;T;U;V;W;X;Y;Z;CTRL_LL;CTRL_ML;CTRL_DL;CTRL_BS".split(";");Decoder.LOWER_TABLE="CTRL_PS; ;a;b;c;d;e;f;g;h;i;j;k;l;m;n;o;p;q;r;s;t;u;v;w;x;y;z;CTRL_US;CTRL_ML;CTRL_DL;CTRL_BS".split(";");
Decoder.MIXED_TABLE="CTRL_PS; ;\\1;\\2;\\3;\\4;\\5;\\6;\\7;\b;\t;\n;\\13;\f;\r;\\33;\\34;\\35;\\36;\\37;@;\\;^;_;`;|;~;\\177;CTRL_LL;CTRL_UL;CTRL_PL;CTRL_BS".split(";");Decoder.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","\x26","'","(",")","*","+",",","-",".","/",":",";","\x3c","\x3d","\x3e","?","[","]","{","}","CTRL_UL"];Decoder.DIGIT_TABLE="CTRL_PS; ;0;1;2;3;4;5;6;7;8;9;,;.;CTRL_UL;CTRL_US".split(";");return Decoder}();exports.default=global}
//# sourceMappingURL=module$node_modules$$zxing$library$cjs$core$aztec$decoder$Decoder.js.map
