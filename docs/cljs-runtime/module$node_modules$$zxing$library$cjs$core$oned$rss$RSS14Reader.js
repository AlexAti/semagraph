shadow$provide.module$node_modules$$zxing$library$cjs$core$oned$rss$RSS14Reader=function(global,require,module,exports){var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b);d.prototype=
null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__values=this&&this.__values||function(o){var s="function"===typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"===typeof o.length)return{next:function(){o&&i>=o.length&&(o=void 0);return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.");};Object.defineProperty(exports,"__esModule",{value:!0});var AbstractRSSReader_1=require("module$node_modules$$zxing$library$cjs$core$oned$rss$AbstractRSSReader"),
Pair_1=require("module$node_modules$$zxing$library$cjs$core$oned$rss$Pair"),Result_1=require("module$node_modules$$zxing$library$cjs$core$Result"),DecodeHintType_1=require("module$node_modules$$zxing$library$cjs$core$DecodeHintType"),NotFoundException_1=require("module$node_modules$$zxing$library$cjs$core$NotFoundException"),StringBuilder_1=require("module$node_modules$$zxing$library$cjs$core$util$StringBuilder"),BarcodeFormat_1=require("module$node_modules$$zxing$library$cjs$core$BarcodeFormat"),
ResultPoint_1=require("module$node_modules$$zxing$library$cjs$core$ResultPoint"),FinderPattern_1=require("module$node_modules$$zxing$library$cjs$core$oned$rss$FinderPattern"),DataCharacter_1=require("module$node_modules$$zxing$library$cjs$core$oned$rss$DataCharacter"),MathUtils_1=require("module$node_modules$$zxing$library$cjs$core$common$detector$MathUtils"),RSSUtils_1=require("module$node_modules$$zxing$library$cjs$core$oned$rss$RSSUtils"),System_1=require("module$node_modules$$zxing$library$cjs$core$util$System"),
OneDReader_1=require("module$node_modules$$zxing$library$cjs$core$oned$OneDReader");global=function(_super){function RSS14Reader(){var _this=null!==_super&&_super.apply(this,arguments)||this;_this.possibleLeftPairs=[];_this.possibleRightPairs=[];return _this}__extends(RSS14Reader,_super);RSS14Reader.prototype.decodeRow=function(rowNumber,row,hints){var _a,e_2,_b,leftPair=this.decodePair(row,!1,rowNumber,hints);RSS14Reader.addOrTally(this.possibleLeftPairs,leftPair);row.reverse();rowNumber=this.decodePair(row,
!0,rowNumber,hints);RSS14Reader.addOrTally(this.possibleRightPairs,rowNumber);row.reverse();try{for(var _c=__values(this.possibleLeftPairs),_d=_c.next();!_d.done;_d=_c.next()){var left=_d.value;if(1<left.getCount())try{for(var _e=(e_2=void 0,__values(this.possibleRightPairs)),_f=_e.next();!_f.done;_f=_e.next()){var right=_f.value;if(1<right.getCount()&&RSS14Reader.checkChecksum(left,right))return RSS14Reader.constructResult(left,right)}}catch(e_2_1){e_2={error:e_2_1}}finally{try{_f&&!_f.done&&(_b=
_e.return)&&_b.call(_e)}finally{if(e_2)throw e_2.error;}}}}catch(e_1_1){var e_1={error:e_1_1}}finally{try{_d&&!_d.done&&(_a=_c.return)&&_a.call(_c)}finally{if(e_1)throw e_1.error;}}throw new NotFoundException_1.default;};RSS14Reader.addOrTally=function(possiblePairs,pair){var _a;if(null!=pair){var found=!1;try{for(var possiblePairs_1=__values(possiblePairs),possiblePairs_1_1=possiblePairs_1.next();!possiblePairs_1_1.done;possiblePairs_1_1=possiblePairs_1.next()){var other=possiblePairs_1_1.value;
if(other.getValue()===pair.getValue()){other.incrementCount();found=!0;break}}}catch(e_3_1){var e_3={error:e_3_1}}finally{try{possiblePairs_1_1&&!possiblePairs_1_1.done&&(_a=possiblePairs_1.return)&&_a.call(possiblePairs_1)}finally{if(e_3)throw e_3.error;}}found||possiblePairs.push(pair)}};RSS14Reader.prototype.reset=function(){this.possibleLeftPairs.length=0;this.possibleRightPairs.length=0};RSS14Reader.constructResult=function(leftPair,rightPair){var symbolValue=4537077*leftPair.getValue()+rightPair.getValue(),
text=(new String(symbolValue)).toString();symbolValue=new StringBuilder_1.default;for(var i=13-text.length;0<i;i--)symbolValue.append("0");symbolValue.append(text);for(i=text=0;13>i;i++){var digit=symbolValue.charAt(i).charCodeAt(0)-48;text+=0===(i&1)?3*digit:digit}text=10-text%10;10===text&&(text=0);symbolValue.append(text.toString());leftPair=leftPair.getFinderPattern().getResultPoints();rightPair=rightPair.getFinderPattern().getResultPoints();return new Result_1.default(symbolValue.toString(),
null,0,[leftPair[0],leftPair[1],rightPair[0],rightPair[1]],BarcodeFormat_1.default.RSS_14,(new Date).getTime())};RSS14Reader.checkChecksum=function(leftPair,rightPair){var checkValue=(leftPair.getChecksumPortion()+16*rightPair.getChecksumPortion())%79;leftPair=9*leftPair.getFinderPattern().getValue()+rightPair.getFinderPattern().getValue();72<leftPair&&leftPair--;8<leftPair&&leftPair--;return checkValue===leftPair};RSS14Reader.prototype.decodePair=function(row,right,rowNumber,hints){try{var startEnd=
this.findFinderPattern(row,right),pattern=this.parseFoundFinderPattern(row,rowNumber,right,startEnd),resultPointCallback=null==hints?null:hints.get(DecodeHintType_1.default.NEED_RESULT_POINT_CALLBACK);if(null!=resultPointCallback){var center=(startEnd[0]+startEnd[1])/2;right&&(center=row.getSize()-1-center);resultPointCallback.foundPossibleResultPoint(new ResultPoint_1.default(center,rowNumber))}var outside=this.decodeDataCharacter(row,pattern,!0),inside=this.decodeDataCharacter(row,pattern,!1);return new Pair_1.default(1597*
outside.getValue()+inside.getValue(),outside.getChecksumPortion()+4*inside.getChecksumPortion(),pattern)}catch(err){return null}};RSS14Reader.prototype.decodeDataCharacter=function(row,pattern,outsideChar){for(var counters=this.getDataCharacterCounters(),x=0;x<counters.length;x++)counters[x]=0;if(outsideChar)OneDReader_1.default.recordPatternInReverse(row,pattern.getStartEnd()[0],counters);else for(OneDReader_1.default.recordPattern(row,pattern.getStartEnd()[1]+1,counters),x=0,row=counters.length-
1;x<row;x++,row--)pattern=counters[x],counters[x]=counters[row],counters[row]=pattern;var numModules=outsideChar?16:15,elementWidth=MathUtils_1.default.sum(new Int32Array(counters))/numModules;pattern=this.getOddCounts();row=this.getEvenCounts();var oddRoundingErrors=this.getOddRoundingErrors(),evenRoundingErrors=this.getEvenRoundingErrors();for(x=0;x<counters.length;x++){var value=counters[x]/elementWidth,count=Math.floor(value+.5);1>count?count=1:8<count&&(count=8);var offset=Math.floor(x/2);0===
(x&1)?(pattern[offset]=count,oddRoundingErrors[offset]=value-count):(row[offset]=count,evenRoundingErrors[offset]=value-count)}this.adjustOddEvenCounts(outsideChar,numModules);elementWidth=counters=0;for(x=pattern.length-1;0<=x;x--)elementWidth*=9,elementWidth+=pattern[x],counters+=pattern[x];numModules=oddRoundingErrors=0;for(x=row.length-1;0<=x;x--)oddRoundingErrors*=9,oddRoundingErrors+=row[x],numModules+=row[x];x=elementWidth+3*oddRoundingErrors;if(outsideChar){if(0!==(counters&1)||12<counters||
4>counters)throw new NotFoundException_1.default;outsideChar=(12-counters)/2;numModules=RSS14Reader.OUTSIDE_ODD_WIDEST[outsideChar];counters=9-numModules;pattern=RSSUtils_1.default.getRSSvalue(pattern,numModules,!1);row=RSSUtils_1.default.getRSSvalue(row,counters,!0);counters=RSS14Reader.OUTSIDE_GSUM[outsideChar];return new DataCharacter_1.default(pattern*RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET[outsideChar]+row+counters,x)}if(0!==(numModules&1)||10<numModules||4>numModules)throw new NotFoundException_1.default;
outsideChar=(10-numModules)/2;numModules=RSS14Reader.INSIDE_ODD_WIDEST[outsideChar];counters=9-numModules;pattern=RSSUtils_1.default.getRSSvalue(pattern,numModules,!0);row=RSSUtils_1.default.getRSSvalue(row,counters,!1);numModules=RSS14Reader.INSIDE_ODD_TOTAL_SUBSET[outsideChar];counters=RSS14Reader.INSIDE_GSUM[outsideChar];return new DataCharacter_1.default(row*numModules+pattern+counters,x)};RSS14Reader.prototype.findFinderPattern=function(row,rightFinderPattern){var counters=this.getDecodeFinderCounters();
counters[0]=0;counters[1]=0;counters[2]=0;counters[3]=0;for(var width=row.getSize(),isWhite=!1,rowOffset=0;rowOffset<width;){isWhite=!row.get(rowOffset);if(rightFinderPattern===isWhite)break;rowOffset++}rightFinderPattern=0;for(var patternStart=rowOffset;rowOffset<width;rowOffset++)if(row.get(rowOffset)!==isWhite)counters[rightFinderPattern]++;else{if(3===rightFinderPattern){if(AbstractRSSReader_1.default.isFinderPattern(counters))return[patternStart,rowOffset];patternStart+=counters[0]+counters[1];
counters[0]=counters[2];counters[1]=counters[3];counters[2]=0;counters[3]=0;rightFinderPattern--}else rightFinderPattern++;counters[rightFinderPattern]=1;isWhite=!isWhite}throw new NotFoundException_1.default;};RSS14Reader.prototype.parseFoundFinderPattern=function(row,rowNumber,right,startEnd){for(var firstIsBlack=row.get(startEnd[0]),firstElementStart=startEnd[0]-1;0<=firstElementStart&&firstIsBlack!==row.get(firstElementStart);)firstElementStart--;firstElementStart++;firstIsBlack=startEnd[0]-firstElementStart;
var counters=this.getDecodeFinderCounters(),copy=new Int32Array(counters.length);System_1.default.arraycopy(counters,0,copy,1,counters.length-1);copy[0]=firstIsBlack;firstIsBlack=this.parseFinderValue(copy,RSS14Reader.FINDER_PATTERNS);counters=firstElementStart;copy=startEnd[1];right&&(counters=row.getSize()-1-counters,copy=row.getSize()-1-copy);return new FinderPattern_1.default(firstIsBlack,[firstElementStart,startEnd[1]],counters,copy,rowNumber)};RSS14Reader.prototype.adjustOddEvenCounts=function(outsideChar,
numModules){var oddSum=MathUtils_1.default.sum(new Int32Array(this.getOddCounts())),evenSum=MathUtils_1.default.sum(new Int32Array(this.getEvenCounts())),incrementOdd=!1,decrementOdd=!1,incrementEven=!1,decrementEven=!1;outsideChar?(12<oddSum?decrementOdd=!0:4>oddSum&&(incrementOdd=!0),12<evenSum?decrementEven=!0:4>evenSum&&(incrementEven=!0)):(11<oddSum?decrementOdd=!0:5>oddSum&&(incrementOdd=!0),10<evenSum?decrementEven=!0:4>evenSum&&(incrementEven=!0));numModules=oddSum+evenSum-numModules;outsideChar=
(oddSum&1)===(outsideChar?1:0);var evenParityBad=1===(evenSum&1);if(1===numModules)if(outsideChar){if(evenParityBad)throw new NotFoundException_1.default;decrementOdd=!0}else{if(!evenParityBad)throw new NotFoundException_1.default;decrementEven=!0}else if(-1===numModules)if(outsideChar){if(evenParityBad)throw new NotFoundException_1.default;incrementOdd=!0}else{if(!evenParityBad)throw new NotFoundException_1.default;incrementEven=!0}else if(0===numModules)if(outsideChar){if(!evenParityBad)throw new NotFoundException_1.default;
oddSum<evenSum?decrementEven=incrementOdd=!0:incrementEven=decrementOdd=!0}else{if(evenParityBad)throw new NotFoundException_1.default;}else throw new NotFoundException_1.default;if(incrementOdd){if(decrementOdd)throw new NotFoundException_1.default;AbstractRSSReader_1.default.increment(this.getOddCounts(),this.getOddRoundingErrors())}decrementOdd&&AbstractRSSReader_1.default.decrement(this.getOddCounts(),this.getOddRoundingErrors());if(incrementEven){if(decrementEven)throw new NotFoundException_1.default;
AbstractRSSReader_1.default.increment(this.getEvenCounts(),this.getOddRoundingErrors())}decrementEven&&AbstractRSSReader_1.default.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())};RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126];RSS14Reader.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81];RSS14Reader.OUTSIDE_GSUM=[0,161,961,2015,2715];RSS14Reader.INSIDE_GSUM=[0,336,1036,1516];RSS14Reader.OUTSIDE_ODD_WIDEST=[8,6,4,3,1];RSS14Reader.INSIDE_ODD_WIDEST=[2,4,6,8];RSS14Reader.FINDER_PATTERNS=[Int32Array.from([3,
8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];return RSS14Reader}(AbstractRSSReader_1.default);exports.default=global}
//# sourceMappingURL=module$node_modules$$zxing$library$cjs$core$oned$rss$RSS14Reader.js.map
