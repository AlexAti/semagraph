shadow$provide.module$node_modules$$zxing$library$cjs$core$common$GlobalHistogramBinarizer=function(global,require,module,exports){var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=d}extendStatics(d,
b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});global=require("module$node_modules$$zxing$library$cjs$core$Binarizer");var BitArray_1=require("module$node_modules$$zxing$library$cjs$core$common$BitArray"),BitMatrix_1=require("module$node_modules$$zxing$library$cjs$core$common$BitMatrix"),NotFoundException_1=require("module$node_modules$$zxing$library$cjs$core$NotFoundException");require=function(_super){function GlobalHistogramBinarizer(source){source=
_super.call(this,source)||this;source.luminances=GlobalHistogramBinarizer.EMPTY;source.buckets=new Int32Array(GlobalHistogramBinarizer.LUMINANCE_BUCKETS);return source}__extends(GlobalHistogramBinarizer,_super);GlobalHistogramBinarizer.prototype.getBlackRow=function(y,row){var source=this.getLuminanceSource(),width=source.getWidth();void 0===row||null===row||row.getSize()<width?row=new BitArray_1.default(width):row.clear();this.initArrays(width);y=source.getRow(y,this.luminances);var localBuckets=
this.buckets;for(source=0;source<width;source++)localBuckets[(y[source]&255)>>GlobalHistogramBinarizer.LUMINANCE_SHIFT]++;localBuckets=GlobalHistogramBinarizer.estimateBlackPoint(localBuckets);if(3>width)for(source=0;source<width;source++)(y[source]&255)<localBuckets&&row.set(source);else{var left=y[0]&255,center=y[1]&255;for(source=1;source<width-1;source++){var right=y[source+1]&255;(4*center-left-right)/2<localBuckets&&row.set(source);left=center;center=right}}return row};GlobalHistogramBinarizer.prototype.getBlackMatrix=
function(){var source=this.getLuminanceSource(),width=source.getWidth(),height=source.getHeight(),matrix=new BitMatrix_1.default(width,height);this.initArrays(width);for(var localBuckets=this.buckets,y=1;5>y;y++)for(var localLuminances_1=source.getRow(Math.floor(height*y/5),this.luminances),right=Math.floor(4*width/5),x=Math.floor(width/5);x<right;x++){var pixel=localLuminances_1[x]&255;localBuckets[pixel>>GlobalHistogramBinarizer.LUMINANCE_SHIFT]++}localBuckets=GlobalHistogramBinarizer.estimateBlackPoint(localBuckets);
source=source.getMatrix();for(y=0;y<height;y++)for(localLuminances_1=y*width,x=0;x<width;x++)pixel=source[localLuminances_1+x]&255,pixel<localBuckets&&matrix.set(x,y);return matrix};GlobalHistogramBinarizer.prototype.createBinarizer=function(source){return new GlobalHistogramBinarizer(source)};GlobalHistogramBinarizer.prototype.initArrays=function(luminanceSize){this.luminances.length<luminanceSize&&(this.luminances=new Uint8ClampedArray(luminanceSize));luminanceSize=this.buckets;for(var x=0;x<GlobalHistogramBinarizer.LUMINANCE_BUCKETS;x++)luminanceSize[x]=
0};GlobalHistogramBinarizer.estimateBlackPoint=function(buckets){for(var numBuckets=buckets.length,maxBucketCount=0,firstPeak=0,firstPeakSize=0,x=0;x<numBuckets;x++)buckets[x]>firstPeakSize&&(firstPeak=x,firstPeakSize=buckets[x]),buckets[x]>maxBucketCount&&(maxBucketCount=buckets[x]);var secondPeakScore=firstPeakSize=0;for(x=0;x<numBuckets;x++){var distanceToBiggest=x-firstPeak;distanceToBiggest*=buckets[x]*distanceToBiggest;distanceToBiggest>secondPeakScore&&(firstPeakSize=x,secondPeakScore=distanceToBiggest)}firstPeak>
firstPeakSize&&(x=firstPeak,firstPeak=firstPeakSize,firstPeakSize=x);if(firstPeakSize-firstPeak<=numBuckets/16)throw new NotFoundException_1.default;numBuckets=firstPeakSize-1;secondPeakScore=-1;for(x=firstPeakSize-1;x>firstPeak;x--)distanceToBiggest=x-firstPeak,distanceToBiggest=distanceToBiggest*distanceToBiggest*(firstPeakSize-x)*(maxBucketCount-buckets[x]),distanceToBiggest>secondPeakScore&&(numBuckets=x,secondPeakScore=distanceToBiggest);return numBuckets<<GlobalHistogramBinarizer.LUMINANCE_SHIFT};
GlobalHistogramBinarizer.LUMINANCE_BITS=5;GlobalHistogramBinarizer.LUMINANCE_SHIFT=8-GlobalHistogramBinarizer.LUMINANCE_BITS;GlobalHistogramBinarizer.LUMINANCE_BUCKETS=1<<GlobalHistogramBinarizer.LUMINANCE_BITS;GlobalHistogramBinarizer.EMPTY=Uint8ClampedArray.from([0]);return GlobalHistogramBinarizer}(global.default);exports.default=require}
//# sourceMappingURL=module$node_modules$$zxing$library$cjs$core$common$GlobalHistogramBinarizer.js.map
