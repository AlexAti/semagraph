shadow$provide.module$node_modules$$zxing$library$cjs$core$pdf417$decoder$PDF417ScanningDecoder=function(global,require,module,exports){var __values=this&&this.__values||function(o){var s="function"===typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"===typeof o.length)return{next:function(){o&&i>=o.length&&(o=void 0);return{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.");};Object.defineProperty(exports,"__esModule",
{value:!0});var ChecksumException_1=require("module$node_modules$$zxing$library$cjs$core$ChecksumException"),FormatException_1=require("module$node_modules$$zxing$library$cjs$core$FormatException"),NotFoundException_1=require("module$node_modules$$zxing$library$cjs$core$NotFoundException"),MathUtils_1=require("module$node_modules$$zxing$library$cjs$core$common$detector$MathUtils"),PDF417Common_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$PDF417Common"),ErrorCorrection_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$decoder$ec$ErrorCorrection"),
BoundingBox_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$decoder$BoundingBox"),DetectionResultRowIndicatorColumn_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$decoder$DetectionResultRowIndicatorColumn"),DetectionResult_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$decoder$DetectionResult"),DetectionResultColumn_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$decoder$DetectionResultColumn"),Codeword_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$decoder$Codeword"),
BarcodeValue_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$decoder$BarcodeValue"),PDF417CodewordDecoder_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$decoder$PDF417CodewordDecoder"),DecodedBitStreamParser_1=require("module$node_modules$$zxing$library$cjs$core$pdf417$decoder$DecodedBitStreamParser"),Formatter_1=require("module$node_modules$$zxing$library$cjs$core$util$Formatter");global=function(){function PDF417ScanningDecoder(){}PDF417ScanningDecoder.decode=function(image,
imageTopLeft,imageBottomLeft,imageTopRight,imageBottomRight,minCodewordWidth,maxCodewordWidth){imageBottomLeft=new BoundingBox_1.default(image,imageTopLeft,imageBottomLeft,imageTopRight,imageBottomRight);for(var leftRowIndicatorColumn=null,rightRowIndicatorColumn=null,firstPass=!0;;firstPass=!1){null!=imageTopLeft&&(leftRowIndicatorColumn=PDF417ScanningDecoder.getRowIndicatorColumn(image,imageBottomLeft,imageTopLeft,!0,minCodewordWidth,maxCodewordWidth));null!=imageTopRight&&(rightRowIndicatorColumn=
PDF417ScanningDecoder.getRowIndicatorColumn(image,imageBottomLeft,imageTopRight,!1,minCodewordWidth,maxCodewordWidth));imageBottomRight=PDF417ScanningDecoder.merge(leftRowIndicatorColumn,rightRowIndicatorColumn);if(null==imageBottomRight)throw NotFoundException_1.default.getNotFoundInstance();var resultBox=imageBottomRight.getBoundingBox();if(firstPass&&null!=resultBox&&(resultBox.getMinY()<imageBottomLeft.getMinY()||resultBox.getMaxY()>imageBottomLeft.getMaxY()))imageBottomLeft=resultBox;else break}imageBottomRight.setBoundingBox(imageBottomLeft);
imageTopLeft=imageBottomRight.getBarcodeColumnCount()+1;imageBottomRight.setDetectionResultColumn(0,leftRowIndicatorColumn);imageBottomRight.setDetectionResultColumn(imageTopLeft,rightRowIndicatorColumn);imageTopRight=null!=leftRowIndicatorColumn;for(leftRowIndicatorColumn=1;leftRowIndicatorColumn<=imageTopLeft;leftRowIndicatorColumn++)if(rightRowIndicatorColumn=imageTopRight?leftRowIndicatorColumn:imageTopLeft-leftRowIndicatorColumn,void 0===imageBottomRight.getDetectionResultColumn(rightRowIndicatorColumn)){firstPass=
0===rightRowIndicatorColumn||rightRowIndicatorColumn===imageTopLeft?new DetectionResultRowIndicatorColumn_1.default(imageBottomLeft,0===rightRowIndicatorColumn):new DetectionResultColumn_1.default(imageBottomLeft);imageBottomRight.setDetectionResultColumn(rightRowIndicatorColumn,firstPass);for(var previousStartColumn=resultBox=-1,imageRow=imageBottomLeft.getMinY();imageRow<=imageBottomLeft.getMaxY();imageRow++){resultBox=PDF417ScanningDecoder.getStartColumn(imageBottomRight,rightRowIndicatorColumn,
imageRow,imageTopRight);if(0>resultBox||resultBox>imageBottomLeft.getMaxX()){if(-1===previousStartColumn)continue;resultBox=previousStartColumn}var codeword=PDF417ScanningDecoder.detectCodeword(image,imageBottomLeft.getMinX(),imageBottomLeft.getMaxX(),imageTopRight,resultBox,imageRow,minCodewordWidth,maxCodewordWidth);null!=codeword&&(firstPass.setCodeword(imageRow,codeword),previousStartColumn=resultBox,minCodewordWidth=Math.min(minCodewordWidth,codeword.getWidth()),maxCodewordWidth=Math.max(maxCodewordWidth,
codeword.getWidth()))}}return PDF417ScanningDecoder.createDecoderResult(imageBottomRight)};PDF417ScanningDecoder.merge=function(leftRowIndicatorColumn,rightRowIndicatorColumn){if(null==leftRowIndicatorColumn&&null==rightRowIndicatorColumn)return null;var barcodeMetadata=PDF417ScanningDecoder.getBarcodeMetadata(leftRowIndicatorColumn,rightRowIndicatorColumn);if(null==barcodeMetadata)return null;leftRowIndicatorColumn=BoundingBox_1.default.merge(PDF417ScanningDecoder.adjustBoundingBox(leftRowIndicatorColumn),
PDF417ScanningDecoder.adjustBoundingBox(rightRowIndicatorColumn));return new DetectionResult_1.default(barcodeMetadata,leftRowIndicatorColumn)};PDF417ScanningDecoder.adjustBoundingBox=function(rowIndicatorColumn){var _a;if(null==rowIndicatorColumn)return null;var rowHeights=rowIndicatorColumn.getRowHeights();if(null==rowHeights)return null;var maxRowHeight=PDF417ScanningDecoder.getMax(rowHeights),missingStartRows=0;try{for(var rowHeights_1=__values(rowHeights),rowHeights_1_1=rowHeights_1.next();!rowHeights_1_1.done;rowHeights_1_1=
rowHeights_1.next()){var rowHeight=rowHeights_1_1.value;missingStartRows+=maxRowHeight-rowHeight;if(0<rowHeight)break}}catch(e_1_1){var e_1={error:e_1_1}}finally{try{rowHeights_1_1&&!rowHeights_1_1.done&&(_a=rowHeights_1.return)&&_a.call(rowHeights_1)}finally{if(e_1)throw e_1.error;}}e_1=rowIndicatorColumn.getCodewords();for(_a=0;0<missingStartRows&&null==e_1[_a];_a++)missingStartRows--;rowHeights_1=0;for(_a=rowHeights.length-1;0<=_a&&!(rowHeights_1+=maxRowHeight-rowHeights[_a],0<rowHeights[_a]);_a--);
for(_a=e_1.length-1;0<rowHeights_1&&null==e_1[_a];_a--)rowHeights_1--;return rowIndicatorColumn.getBoundingBox().addMissingRows(missingStartRows,rowHeights_1,rowIndicatorColumn.isLeft())};PDF417ScanningDecoder.getMax=function(values){var _a,maxValue=-1;try{for(var values_1=__values(values),values_1_1=values_1.next();!values_1_1.done;values_1_1=values_1.next())maxValue=Math.max(maxValue,values_1_1.value)}catch(e_2_1){var e_2={error:e_2_1}}finally{try{values_1_1&&!values_1_1.done&&(_a=values_1.return)&&
_a.call(values_1)}finally{if(e_2)throw e_2.error;}}return maxValue};PDF417ScanningDecoder.getBarcodeMetadata=function(leftRowIndicatorColumn,rightRowIndicatorColumn){var leftBarcodeMetadata;if(null==leftRowIndicatorColumn||null==(leftBarcodeMetadata=leftRowIndicatorColumn.getBarcodeMetadata()))return null==rightRowIndicatorColumn?null:rightRowIndicatorColumn.getBarcodeMetadata();var rightBarcodeMetadata;return null==rightRowIndicatorColumn||null==(rightBarcodeMetadata=rightRowIndicatorColumn.getBarcodeMetadata())?
leftBarcodeMetadata:leftBarcodeMetadata.getColumnCount()!==rightBarcodeMetadata.getColumnCount()&&leftBarcodeMetadata.getErrorCorrectionLevel()!==rightBarcodeMetadata.getErrorCorrectionLevel()&&leftBarcodeMetadata.getRowCount()!==rightBarcodeMetadata.getRowCount()?null:leftBarcodeMetadata};PDF417ScanningDecoder.getRowIndicatorColumn=function(image,boundingBox,startPoint,leftToRight,minCodewordWidth,maxCodewordWidth){for(var rowIndicatorColumn=new DetectionResultRowIndicatorColumn_1.default(boundingBox,
leftToRight),i=0;2>i;i++)for(var increment=0===i?1:-1,startColumn=Math.trunc(Math.trunc(startPoint.getX())),imageRow=Math.trunc(Math.trunc(startPoint.getY()));imageRow<=boundingBox.getMaxY()&&imageRow>=boundingBox.getMinY();imageRow+=increment){var codeword=PDF417ScanningDecoder.detectCodeword(image,0,image.getWidth(),leftToRight,startColumn,imageRow,minCodewordWidth,maxCodewordWidth);null!=codeword&&(rowIndicatorColumn.setCodeword(imageRow,codeword),startColumn=leftToRight?codeword.getStartX():codeword.getEndX())}return rowIndicatorColumn};
PDF417ScanningDecoder.adjustCodewordCount=function(detectionResult,barcodeMatrix){barcodeMatrix=barcodeMatrix[0][1];var numberOfCodewords=barcodeMatrix.getValue();detectionResult=detectionResult.getBarcodeColumnCount()*detectionResult.getBarcodeRowCount()-PDF417ScanningDecoder.getNumberOfECCodeWords(detectionResult.getBarcodeECLevel());if(0===numberOfCodewords.length){if(1>detectionResult||detectionResult>PDF417Common_1.default.MAX_CODEWORDS_IN_BARCODE)throw NotFoundException_1.default.getNotFoundInstance();
barcodeMatrix.setValue(detectionResult)}else numberOfCodewords[0]!==detectionResult&&barcodeMatrix.setValue(detectionResult)};PDF417ScanningDecoder.createDecoderResult=function(detectionResult){var barcodeMatrix=PDF417ScanningDecoder.createBarcodeMatrix(detectionResult);PDF417ScanningDecoder.adjustCodewordCount(detectionResult,barcodeMatrix);for(var erasures=[],codewords=new Int32Array(detectionResult.getBarcodeRowCount()*detectionResult.getBarcodeColumnCount()),ambiguousIndexValuesList=[],ambiguousIndexesList=
[],row=0;row<detectionResult.getBarcodeRowCount();row++)for(var column=0;column<detectionResult.getBarcodeColumnCount();column++){var values=barcodeMatrix[row][column+1].getValue(),codewordIndex=row*detectionResult.getBarcodeColumnCount()+column;0===values.length?erasures.push(codewordIndex):1===values.length?codewords[codewordIndex]=values[0]:(ambiguousIndexesList.push(codewordIndex),ambiguousIndexValuesList.push(values))}barcodeMatrix=Array(ambiguousIndexValuesList.length);for(row=0;row<barcodeMatrix.length;row++)barcodeMatrix[row]=
ambiguousIndexValuesList[row];return PDF417ScanningDecoder.createDecoderResultFromAmbiguousValues(detectionResult.getBarcodeECLevel(),codewords,PDF417Common_1.default.toIntArray(erasures),PDF417Common_1.default.toIntArray(ambiguousIndexesList),barcodeMatrix)};PDF417ScanningDecoder.createDecoderResultFromAmbiguousValues=function(ecLevel,codewords,erasureArray,ambiguousIndexes,ambiguousIndexValues){for(var ambiguousIndexCount=new Int32Array(ambiguousIndexes.length),tries=100;0<tries--;){for(var i=0;i<
ambiguousIndexCount.length;i++)codewords[ambiguousIndexes[i]]=ambiguousIndexValues[i][ambiguousIndexCount[i]];try{return PDF417ScanningDecoder.decodeCodewords(codewords,ecLevel,erasureArray)}catch(err){if(!(err instanceof ChecksumException_1.default))throw err;}if(0===ambiguousIndexCount.length)break;for(i=0;i<ambiguousIndexCount.length;i++)if(ambiguousIndexCount[i]<ambiguousIndexValues[i].length-1){ambiguousIndexCount[i]++;break}else if(ambiguousIndexCount[i]=0,i===ambiguousIndexCount.length-1)throw ChecksumException_1.default.getChecksumInstance();
}throw ChecksumException_1.default.getChecksumInstance();};PDF417ScanningDecoder.createBarcodeMatrix=function(detectionResult){for(var e_3,_a,e_4,_b,barcodeMatrix=Array.from({length:detectionResult.getBarcodeRowCount()},function(){return Array(detectionResult.getBarcodeColumnCount()+2)}),row=0;row<barcodeMatrix.length;row++)for(var column_1=0;column_1<barcodeMatrix[row].length;column_1++)barcodeMatrix[row][column_1]=new BarcodeValue_1.default;row=0;try{for(var _c=__values(detectionResult.getDetectionResultColumns()),
_d=_c.next();!_d.done;_d=_c.next()){var detectionResultColumn=_d.value;if(null!=detectionResultColumn)try{for(var _e=(e_4=void 0,__values(detectionResultColumn.getCodewords())),_f=_e.next();!_f.done;_f=_e.next()){var codeword=_f.value;if(null!=codeword){var rowNumber=codeword.getRowNumber();0<=rowNumber&&!(rowNumber>=barcodeMatrix.length)&&barcodeMatrix[rowNumber][row].setValue(codeword.getValue())}}}catch(e_4_1){e_4={error:e_4_1}}finally{try{_f&&!_f.done&&(_b=_e.return)&&_b.call(_e)}finally{if(e_4)throw e_4.error;
}}row++}}catch(e_3_1){e_3={error:e_3_1}}finally{try{_d&&!_d.done&&(_a=_c.return)&&_a.call(_c)}finally{if(e_3)throw e_3.error;}}return barcodeMatrix};PDF417ScanningDecoder.isValidBarcodeColumn=function(detectionResult,barcodeColumn){return 0<=barcodeColumn&&barcodeColumn<=detectionResult.getBarcodeColumnCount()+1};PDF417ScanningDecoder.getStartColumn=function(detectionResult,barcodeColumn,imageRow,leftToRight){var e_5,_a,offset=leftToRight?1:-1,codeword=null;PDF417ScanningDecoder.isValidBarcodeColumn(detectionResult,
barcodeColumn-offset)&&(codeword=detectionResult.getDetectionResultColumn(barcodeColumn-offset).getCodeword(imageRow));if(null!=codeword)return leftToRight?codeword.getEndX():codeword.getStartX();codeword=detectionResult.getDetectionResultColumn(barcodeColumn).getCodewordNearby(imageRow);if(null!=codeword)return leftToRight?codeword.getStartX():codeword.getEndX();PDF417ScanningDecoder.isValidBarcodeColumn(detectionResult,barcodeColumn-offset)&&(codeword=detectionResult.getDetectionResultColumn(barcodeColumn-
offset).getCodewordNearby(imageRow));if(null!=codeword)return leftToRight?codeword.getEndX():codeword.getStartX();for(imageRow=0;PDF417ScanningDecoder.isValidBarcodeColumn(detectionResult,barcodeColumn-offset);){barcodeColumn-=offset;try{for(var _b=(e_5=void 0,__values(detectionResult.getDetectionResultColumn(barcodeColumn).getCodewords())),_c=_b.next();!_c.done;_c=_b.next()){var previousRowCodeword=_c.value;if(null!=previousRowCodeword)return(leftToRight?previousRowCodeword.getEndX():previousRowCodeword.getStartX())+
offset*imageRow*(previousRowCodeword.getEndX()-previousRowCodeword.getStartX())}}catch(e_5_1){e_5={error:e_5_1}}finally{try{_c&&!_c.done&&(_a=_b.return)&&_a.call(_b)}finally{if(e_5)throw e_5.error;}}imageRow++}return leftToRight?detectionResult.getBoundingBox().getMinX():detectionResult.getBoundingBox().getMaxX()};PDF417ScanningDecoder.detectCodeword=function(image,minColumn,maxColumn,leftToRight,startColumn,imageRow,minCodewordWidth,maxCodewordWidth){startColumn=PDF417ScanningDecoder.adjustCodewordStartColumn(image,
minColumn,maxColumn,leftToRight,startColumn,imageRow);image=PDF417ScanningDecoder.getModuleBitCount(image,minColumn,maxColumn,leftToRight,startColumn,imageRow);if(null==image)return null;minColumn=MathUtils_1.default.sum(image);if(leftToRight)leftToRight=startColumn+minColumn;else{for(leftToRight=0;leftToRight<image.length/2;leftToRight++)maxColumn=image[leftToRight],image[leftToRight]=image[image.length-1-leftToRight],image[image.length-1-leftToRight]=maxColumn;leftToRight=startColumn;startColumn=
leftToRight-minColumn}if(!PDF417ScanningDecoder.checkCodewordSkew(minColumn,minCodewordWidth,maxCodewordWidth))return null;minCodewordWidth=PDF417CodewordDecoder_1.default.getDecodedValue(image);maxCodewordWidth=PDF417Common_1.default.getCodeword(minCodewordWidth);return-1===maxCodewordWidth?null:new Codeword_1.default(startColumn,leftToRight,PDF417ScanningDecoder.getCodewordBucketNumber(minCodewordWidth),maxCodewordWidth)};PDF417ScanningDecoder.getModuleBitCount=function(image,minColumn,maxColumn,
leftToRight,startColumn,imageRow){for(var moduleBitCount=new Int32Array(8),moduleNumber=0,increment=leftToRight?1:-1,previousPixelValue=leftToRight;(leftToRight?startColumn<maxColumn:startColumn>=minColumn)&&moduleNumber<moduleBitCount.length;)image.get(startColumn,imageRow)===previousPixelValue?(moduleBitCount[moduleNumber]++,startColumn+=increment):(moduleNumber++,previousPixelValue=!previousPixelValue);return moduleNumber===moduleBitCount.length||startColumn===(leftToRight?maxColumn:minColumn)&&
moduleNumber===moduleBitCount.length-1?moduleBitCount:null};PDF417ScanningDecoder.getNumberOfECCodeWords=function(barcodeECLevel){return 2<<barcodeECLevel};PDF417ScanningDecoder.adjustCodewordStartColumn=function(image,minColumn,maxColumn,leftToRight,codewordStartColumn,imageRow){for(var correctedStartColumn=codewordStartColumn,increment=leftToRight?-1:1,i=0;2>i;i++){for(;(leftToRight?correctedStartColumn>=minColumn:correctedStartColumn<maxColumn)&&leftToRight===image.get(correctedStartColumn,imageRow);){if(Math.abs(codewordStartColumn-
correctedStartColumn)>PDF417ScanningDecoder.CODEWORD_SKEW_SIZE)return codewordStartColumn;correctedStartColumn+=increment}increment=-increment;leftToRight=!leftToRight}return correctedStartColumn};PDF417ScanningDecoder.checkCodewordSkew=function(codewordSize,minCodewordWidth,maxCodewordWidth){return minCodewordWidth-PDF417ScanningDecoder.CODEWORD_SKEW_SIZE<=codewordSize&&codewordSize<=maxCodewordWidth+PDF417ScanningDecoder.CODEWORD_SKEW_SIZE};PDF417ScanningDecoder.decodeCodewords=function(codewords,
ecLevel,erasures){if(0===codewords.length)throw FormatException_1.default.getFormatInstance();var numECCodewords=1<<ecLevel+1,correctedErrorsCount=PDF417ScanningDecoder.correctErrors(codewords,erasures,numECCodewords);PDF417ScanningDecoder.verifyCodewordCount(codewords,numECCodewords);codewords=DecodedBitStreamParser_1.default.decode(codewords,""+ecLevel);codewords.setErrorsCorrected(correctedErrorsCount);codewords.setErasures(erasures.length);return codewords};PDF417ScanningDecoder.correctErrors=
function(codewords,erasures,numECCodewords){if(null!=erasures&&erasures.length>numECCodewords/2+PDF417ScanningDecoder.MAX_ERRORS||0>numECCodewords||numECCodewords>PDF417ScanningDecoder.MAX_EC_CODEWORDS)throw ChecksumException_1.default.getChecksumInstance();return PDF417ScanningDecoder.errorCorrection.decode(codewords,numECCodewords,erasures)};PDF417ScanningDecoder.verifyCodewordCount=function(codewords,numECCodewords){if(4>codewords.length)throw FormatException_1.default.getFormatInstance();var numberOfCodewords=
codewords[0];if(numberOfCodewords>codewords.length)throw FormatException_1.default.getFormatInstance();if(0===numberOfCodewords)if(numECCodewords<codewords.length)codewords[0]=codewords.length-numECCodewords;else throw FormatException_1.default.getFormatInstance();};PDF417ScanningDecoder.getBitCountForCodeword=function(codeword){for(var result=new Int32Array(8),previousValue=0,i=result.length-1;!((codeword&1)!==previousValue&&(previousValue=codeword&1,i--,0>i));)result[i]++,codeword>>=1;return result};
PDF417ScanningDecoder.getCodewordBucketNumber=function(codeword){return codeword instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(codeword):this.getCodewordBucketNumber_number(codeword)};PDF417ScanningDecoder.getCodewordBucketNumber_number=function(codeword){return PDF417ScanningDecoder.getCodewordBucketNumber(PDF417ScanningDecoder.getBitCountForCodeword(codeword))};PDF417ScanningDecoder.getCodewordBucketNumber_Int32Array=function(moduleBitCount){return(moduleBitCount[0]-moduleBitCount[2]+
moduleBitCount[4]-moduleBitCount[6]+9)%9};PDF417ScanningDecoder.toString=function(barcodeMatrix){for(var formatter=new Formatter_1.default,row=0;row<barcodeMatrix.length;row++){formatter.format("Row %2d: ",row);for(var column=0;column<barcodeMatrix[row].length;column++){var barcodeValue=barcodeMatrix[row][column];0===barcodeValue.getValue().length?formatter.format("        ",null):formatter.format("%4d(%2d)",barcodeValue.getValue()[0],barcodeValue.getConfidence(barcodeValue.getValue()[0]))}formatter.format("%n")}return formatter.toString()};
PDF417ScanningDecoder.CODEWORD_SKEW_SIZE=2;PDF417ScanningDecoder.MAX_ERRORS=3;PDF417ScanningDecoder.MAX_EC_CODEWORDS=512;PDF417ScanningDecoder.errorCorrection=new ErrorCorrection_1.default;return PDF417ScanningDecoder}();exports.default=global}
//# sourceMappingURL=module$node_modules$$zxing$library$cjs$core$pdf417$decoder$PDF417ScanningDecoder.js.map
